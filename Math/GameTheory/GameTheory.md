# 博弈论之SG函数

&emsp; 在许多地方曾经流行过这样一个小游戏：分别包含 $3$ 枚，$5$ 枚，$7$ 枚。两人轮流行动，每次可以选择任意一堆，从中取走任意多的硬币，可一把取光，但不可不取，取走最后一枚的人胜利。

&emsp; 这类游戏可以推广为更一般的形式：

&emsp; ***给定 $n$ 堆物品，每堆物品有 $A_i$ 个。两名玩家轮流行动，每次可以任选一堆，取走任意多的物品。取走最后一个物品的人获胜。两人都采用最佳策略，问先手能否获胜***。

&emsp; 我们把这种游戏称为 **$NIM$ 博弈**。我们把游戏中面临的状态成为 **局面**。整局游戏中第一个行动的成为 **先手**。第二个行动的称为 **后手**。若在某一局面下无论采取任何行动都会输掉游戏，称该局面 **必败** 。所谓采取最优策略是指，在某一局面下存在某种行动，使得行动后手面临必败局面，则优先采取该行动。同时这种局面成为 **必胜**。我们讨论的是理想情况，就是说两人都无失误。$NIM$ 游戏不存在平局，只有 **先手必胜** 和 **先手必败** 两种情况。

----

## 定理：
&emsp; 在 $NIM$ 博弈中先手必胜，当且仅当 $A_1 xor A_2 xor \cdots xor A_n \neq 0$ （~~异或运算不同为 1 相同为 0~~）

## 证明：
&emsp; 所有物品都被拿光是一种必败局面（~~对手已经胜利了~~）此时显然有 $A_1 xor A_2 xor \cdots xor A_n = 0

&emsp; 对于任意一个局面，如果 $A_1 xor A_2 xor \cdots xor A_n = x \neq 0$ 设 $x$ 在二进制表示下最高位的 $1$ 在第 $k$ 位。那么至少存在一堆物品 $A_i$，他的第 $k$ 位为 $1$。显然 $A_i xor x < A_i$，我们就从 $A_i$ 堆中取走若干个物品使其变为 $A_i xor x$，就得到了一个各堆石子异或起来等于 $0$ 的局面。

&emsp; 对于任意一个局面，如果 $A_1 xor A_2 xor \cdots xor A_n = 0$，那么无论如何取物品得到的局面下各个石子异或和都不为 $0$。用反证法证明：假设 $A_i$ 被取成了 $A_i'$，并且 $A_1 xor A_2 xor \cdots xor A_i' xor \cdots xor A_n = 0$。由异或运算取消律（~~取消律：a xor c == b xor c 则 a == b~~）得到 $A_i' = A_i$，与 "不能不取物品" 的规则相违背。所以对于任意一个局面，如果 $A_1 xor A_2 xor \cdots xor A_n = 0$，无论如何取物品得到的局面下各个石子异或和都不为 $0$。

&emsp; 综上所述，$A_1 xor A_2 xor \cdots xor A_n \neq 0$为必胜局面。

证毕。

----
## 公平组合游戏 $ICG$

&emsp; &emsp; 若一个游戏满足：<br>
&emsp; &emsp; 1. 两名玩家交替行动<br>
&emsp; &emsp; 2. 在游戏中的任意时刻，可以执行的合法行动与轮到的玩家无关<br>
&emsp; &emsp; 3. 不能行动的玩家判负<br>
&emsp; &emsp; 则称这个游戏是一个公平组合游戏<br>
&emsp; &emsp; $NIM$ 博弈属于公平组合游戏，但常见的棋类游戏就不是公平组合游戏。

----
## 有向图游戏

&emsp; 给定一个有向无环图，图中有一个唯一的起点，在起点上放一枚棋子。两名玩家交替的把这枚棋子沿有向边进行移动，每次移动一步，无法移动者判负。该游戏被称为 **有向图游戏**。

&emsp; 把每个局面看成图中的一个节点，每个局面按照合法行动能达到的下一个局面连一个有向边。就可以把任何一个公平组合游戏都能转化成一个有向图游戏。

### Mex 运算

&emsp; 设 $S$ 表示一个非负整数集合。定义 $mex(S)$ 为求出不属于集合 $S$ 的最小非负证书的运算，即：

$$ mex(S) = \min_{x \in N,x \notin S} \lbrace x \rbrace $$

### SG 函数
&emsp; 在有向图游戏中，对于每个节点 $x$，设从 $x$ 出发共有 $k$ 条有向边，分别到达节点 $y_1, y_2, \cdots , y_k$，定义 $SG(x)$ 为 $x$ 的后继节点 $y_1, y_2, \cdots , y_k$ 的 $SG$ 函数构成的集合再执行 $mex$ 运算的结果，即：

$$ SG(x)  = mex\bigg( \lbrace SG(y_1), SG(y_2), \cdots, SG(y_k) \rbrace \bigg)$$

&emsp; 特别的，整个有向图 $G$ 的 $SG$ 函数值被定义为有向图游戏起点 $s$ 的 $SG$ 函数值，即 $SG(G) = SG(s)$。

### 有向图游戏的和
&emsp; 设 $G_1, G_2, \cdots, G_m$ 是 $m$ 个有向图游戏。定义有向图游戏 $G$，它的行动规则是人选某个有向图游戏 $G_i$，并再 $G_i$ 上行动一步。$G$ 被称为有向图游戏 $G_1, G_2, \cdots, G_m$ 的和。

&emsp; 有向图游戏的和是 $SG$ 函数值的异或和。

$$ SG(G) = SG(G_1) xor SG(G_2) xor \cdots xor SG(G_m) $$

### 定理：
1. 有向图游戏的某个局面必胜，当且仅当该局面对应的节点的 $SG$ 函数值大于 $0$。
2. 有向图游戏的某个局面必败，当且仅当该局面对应的节点的 $SG$ 函数值等于 $0$。
